
label visit_elsa_ruined_temple:
    scene ruined_temple with fade
    show elsa neutral with dissolve

    if first_time_elsa and chosen_blessing.name == "Магический Потенциал":
        jump elsa_first_time_blessing
    elif first_time_elsa and chosen_blessing.name != "Магический Потенциал":
        jump elsa_first_time_no_blessing
    else: 
        e "Ты вернулся? Не думала, что ты найдёшь меня интересной."
        e "Но раз уж ты здесь… можешь рассказать, что узнал?"
        jump elsa_not_first_time


label elsa_first_time_blessing:
    $ first_time_elsa = False
    e "Ты... не похож на местного. Кто ты?"  
    e "Хм... возможно, судьба привела тебя ко мне. Или ты просто случайно забрёл?"
    
    "Её ледяной взгляд пробирает до костей. Я не чувствую враждебности, но ощущение, будто она читает меня насквозь, оставляет лёгкое напряжение."  

    e "Что ж, посмотрим, чего ты стоишь."

    "От её слов становится неуютно. Как будто я уже не человек, а объект для изучения. Надеюсь, проверка не закончится чем-то радикальным вроде замораживания."  

    # Эльза внимательно осматривает игрока
    show elsa smirk
    e "Ты хоть что-то знаешь о магии? Хотя бы основы?"

    "Чёрт, даже если я отвечу, наверняка прозвучит глупо. Но молчать тоже не вариант…"  

    menu:
        "Ну... это когда кидаешь файерболлы?":
            p "Ну... это когда кидаешь файерболлы?"
            show elsa annoyed
            e "Прекрасно. Прямо как деревенский ребёнок, увидевший фокусника на ярмарке."

            "Я чувствую, как уровень уважения ко мне резко падает. Великолепно, ещё чуть-чуть — и меня, наверное, объявят официальным идиотом."  

        "Конечно! Магия — это когда чертишь круги и читаешь заклинания.":
            p "Конечно! Магия — это когда чертишь круги и читаешь заклинания."
            show elsa unimpressed
            e "Боже... Где ты это услышал? Ты, наверное, ещё думаешь, что магия — это просто красивые слова и жесты?"

            "Я сжимаю губы. Кажется, все мои представления о магии только что были растоптаны в ледяной кашу."  

        "Магия? Это что-то про зелья?":
            p "Магия? Это что-то про зелья?"
            show elsa sigh
            e "Ты вообще понимаешь разницу между алхимией и магией? Нет, конечно же, не понимаешь..."

            "Отлично. Теперь я ещё и невежественный деревенщина. Ну, день определённо идёт в гору."  

    e "Так, ясно. Ты полнейший профан."
    e "Попробуем ещё раз."

    "Её голос звучит так, будто она уже потеряла надежду. Это обидно, но если я сейчас сдамся — точно оставлю о себе впечатление беспросветного глупца."  

    # Второй вопрос
    show elsa thinking
    e "А что ты знаешь про потоки маны? Как её контролировать?"

    "Я знаю, что если сейчас скажу что-то не то, меня окончательно сочтут безнадёжным. Нужно выдать хоть что-то вразумительное..."  

    menu:
        "Нужно просто сильно захотеть, и оно само заработает.":
            p "Нужно просто сильно захотеть, и оно само заработает."
            show elsa facepalm
            e "Конечно. Как же я не догадалась? Достаточно пожелать, и ты станешь архимагом. Гениально."

            "Я уже готов провалиться сквозь землю. Зачем я вообще это сказал?.."  

        "Эм... потоки маны — это как кровь в жилах, верно?":
            p "Эм... потоки маны — это как кровь в жилах, верно?"
            show elsa unimpressed
            e "Допустим. И как ты собираешься её использовать, знаток?"

            "Похоже, это не самый худший ответ. Но её взгляд явно говорит: \"Ну давай, выкручивайся дальше\"."  

        "Я могу просто скопировать чужое заклинание, верно?":
            p "Я могу просто скопировать чужое заклинание, верно?"
            show elsa laugh
            e "Хахах... Ох, ты серьёзно? Может, ты ещё думаешь, что можно выучить магию, просто наблюдая за магами?"

            "Я, честно говоря, не думал, что это настолько глупая идея. Но её смех явно намекает: «Да, ты только что поставил новый рекорд тупости»."  

    e "Ты безнадёжен. Ладно, последний шанс."

    "Я мысленно выдыхаю. Последний шанс? Это что, проверка на профпригодность? Что будет, если я провалю этот \"экзамен\"?"  

    # Третий вопрос
    show elsa neutral
    e "Какое заклинание ты бы использовал, если оказался окружённым врагами?"

    "Так, тут хотя бы понятный сценарий. Надо просто выбрать что-то логичное…"  

    menu:
        "Молния! Всех шарахнет, и проблема решена.":
            p "Молния! Всех шарахнет, и проблема решена."
            show elsa smirk
            e "Ты хоть представляешь, сколько маны требует магия молний? Хотя нет, конечно не представляешь."

            "Её тон с лёгкой насмешкой, но больше в нём разочарования. Упс."  

        "Создам барьер и пережду.":
            p "Создам барьер и пережду."
            show elsa annoyed
            e "Да-да, сиди в своём пузыре, пока тебя не разорвут в клочья."

            "Ну, звучит логично... Наверное, не стоило рассчитывать, что враги просто постоят и подождут, пока я придумаю план."  

        "Попробую договориться?":
            p "Попробую договориться?"
            show elsa deadpan
            e "С врагами. В бою. Ага. Ты ещё цветы им подари."

            "Да, ладно. Наверное, не самая умная идея, но я хотя бы попытался!"  

    show elsa confident
    e "Ясно. Ты не просто ничего не знаешь. Ты ходячая катастрофа."
    e "Так оставлять нельзя. Ты идёшь со мной. Прямо сейчас."

    "Что?.. Куда? Я не подписывался на это!"  

    p "К-куда?!"

    show elsa smirk
    e "В магическую башню. Может, там из тебя ещё можно что-то сделать."

    "Отлично. Я-то думал, она просто посмеётся и забудет обо мне. А теперь я внезапно оказался её подопытным. Почему у меня такое чувство, что ничего хорошего из этого не выйдет?"  

    scene city_gate with fade
    show elsa neutral

    e "Добро пожаловать в город. Раз уж ты не можешь отличить магию от цирковых фокусов, тебе не помешает экскурсия."
    $ can_visit_library = True
    e "Там находится библиотека. Если будешь её посещать — появится хоть какая-то надежда, что ты перестанешь нести чушь."
    e "А дальше, на холме, стоит магическая башня. Там решат, можно ли из тебя сделать хоть что-то полезное."
    e "Не тормози, идём сразу к наставнице, пускай она тебя оценит."

    "Кажется, у меня нет выбора. Судя по её тону, если я попытаюсь сбежать, она просто заморозит меня и дотащит за шкирку."  

    menu:
        "Идти за [e.name]":
            $ can_visit_magic_tower = True
            jump magic_tower_elsa

label elsa_first_time_no_blessing:
    $ first_time_elsa = False
    e "Ты... не похож на местного. Кто ты?"
    e "Хм... возможно, судьба привела тебя ко мне. Или ты просто случайно забрёл?"
    # Эльза осматривает игрока и понимает, что магии он не знает
    show elsa neutral
    e "От тебя исходит слабая аура, но ты не чувствуешь магию? Ты даже не понимаешь, как всё работает."

    "Что-то в её взгляде настораживает. Похоже, я совсем не произвёл впечатления, которое надеялся."  
    "Неужели я правда не могу почувствовать магию? И чем я вообще здесь занимаюсь? Если я не смогу понять хотя бы основы, это будет катастрофа."  

    menu:
        "Эм... я не уверен, что понимаю, о чём ты говоришь.": 
            p "Эм... я не уверен, что понимаю, о чём ты говоришь."
            show elsa sigh
            e "Нет, я не ошиблась. Ты вообще не чувствуешь её. Что ж, очевидно, ты не обладаешь магическим потенциалом."

            "Я чувствую, как её разочарование буквально пробивает меня насквозь. Ну конечно, магией я не владею. Просто чудо, что я вообще оказался здесь."  

        "Я точно что-то чувствую... но не могу объяснить.": 
            p "Я точно что-то чувствую... но не могу объяснить."
            show elsa deadpan
            e "Ты ещё хочешь убедить меня, что ты маг? Нет, ты — просто обычный смертный. Мечты не помогут тебе овладеть магией."

            "Она явно не верит мне. И я даже не могу предъявить доказательства. Может, если бы я мог хотя бы сделать что-то подобное, она бы поняла, что я не просто... ну, лузер."  

    e "Я думала, что ты окажешься чем-то более интересным, но похоже, что я ошиблась."
    e "Тем не менее, ты не бесполезен. Время покажет, может быть, тебе всё-таки удастся стать кем-то великим."
    e "Но, что бы там ни было, у тебя есть шанс научиться чему-то. Конечно же у меня!"
    show elsa smirk
    e "Мы можем устроить соревнование! Я покажу тебе пару трюков и ты постараешься повторить. Если сможешь — может быть, я даже что-то придумаю, как тебя обучить."

    "Что?.. Соревнование? Она что, всерьёз думает, что я могу соревноваться с ней? Если я проиграю, мне точно не поздоровится..."  

    p "Ты хочешь со мной соревноваться?"
    e "Да. Это будет забавно, не правда ли? Ты даже не знаешь, как с этим справиться, а я смогу проверить, насколько ты поддаёшься обучению."

    "Мне кажется, она считает меня не более чем забавным экспериментом. Может, она и права… но мне нужно попробовать, иначе всё потеряно."  

    scene ruined_temple with fade
    e "Готов? Давай начнём."

    "В голове вертится миллион мыслей. Если я облажаюсь, Эльза, похоже, не даст мне второго шанса. Но если я покажу хоть что-то, что она не ожидает... это будет шанс доказать, что я не такой уж полный ноль."  

    # Здесь можно вставить мини-игру или другой механизм для тренировки
    menu:
        "Да, я готов!": 
            p "Да, я готов!"
            e "Хорошо, приготовься!"

            "Она говорит, как будто я уже должен был быть готовым. Надеюсь, я не сделаю чего-то глупого."  

        "Я, наверное, не готов…": 
            p "Я, наверное, не готов…"
            e "Не переживай, это будет весело. А если ты не справишься, я просто покажу тебе, как делать правильно."

            "Это как-то не успокаивает. Я не уверен, что готов быть её подопытным кроликом. Но что-то мне подсказывает, что иначе она меня просто не отпустит."  

    # Переход к соревнованию или мини-игре
    jump magic_training


label elsa_not_first_time:

    menu:
        "Можешь научить меня чему-нибудь по магии?":
            p "Можешь научить меня чему-нибудь по магии?"
            e "Научу. Но учти, что ты не маг, и тебе придется начинать с самых основ."
            e "Здесь, в лесу, я могу показать тебе пару трюков, если ты не боишься немножко поработать."
            p "Да, я готов к тренировке по магии."
            e "Хорошо. Начнем с простого. Но ты готов, что будет тяжело."
            jump magic_training

        "Я бы хотел узнать, где здесь библиотека" if not can_visit_library:
            p "Я бы хотел узнать, где здесь библиотека или магическая башня."
            e "Ах, тебе интересно? Хорошо, я покажу тебе путь."
            e "Но помни, что в магической башне будут решать, что с тобой делать. Там не любят бездарей."
            p "Покажи мне путь в библиотеку."
            e "Отлично, пойдём, я покажу тебе дорогу. Только не потеряйся."
            jump go_to_city_with_elsa

        "Ты что-то ищешь в лесу?":
            p "Ты что-то ищешь в лесу?"
            e "Да, я ищу компонены для заклюнаний. И, насколько вижу, ты особо не занят."
            e "У меня есть парочка заданий для тебя. Если хочешь, могу научить тебя собирать магические компоненты."
            e "Это будет полезно, и если ты справишься, я подумаю, что с тобой дальше делать."
            e "Или ты мне можешь пригодиться, как испытуемый, сам решай."
            jump elsa_quests

        "Вернуть к храму":
            jump ruined_temple
    jump elsa_not_first_time

    

label elsa_quests:
    menu:
        "Собирать магические материалы":
            p "Я готов собирать магические материалы."
            e "Хорошо, мне нужно несколько редких трав и минералов. Ты можешь найти их в этих лесах."
            $ active_quest = quest_elsa_materials
        "Стать испытуемым":
            p "Я готов стать подпытным кроликом."
            e "Я вижу, что ты довольно крепкий, если у тебя все еще хватает ума заходить в этот лес."
            e "Твоё тело мне пригодится~"
            $ active_quest = quest_elsa_test
            jump elsa_test
        "Я передумал":
            jump elsa_not_first_time
    return

label go_to_city_with_elsa:
    scene city_gate with fade
    show elsa neutral

    e "Добро пожаловать в город. Здесь ты найдёшь то, что тебе нужно."
    e "Вон там библиотека — источник знаний, который поможет тебе понять, что такое магия."
    e "А дальше, на холме, стоит магическая башня. Если хочешь обучаться, тебе нужно будет туда."

    menu:
        "Зайти в библиотеку":
            $ can_visit_library = True
            jump library_elsa
        "Идти сразу в магическую башню":
            jump magic_tower