# Определение персонажей
define t = Character("Торговка", color="#ff69b4")  # Наш аниме-персонаж

# Объявление переменных: love – показатель симпатии, visited_market – флаг первого посещения
default first_visit_market = True
default can_work_with_holo = False

# Сцена посещения рынка
label market:
    scene bg market with fade
    "Вы приходите на оживлённый рынок, где запах свежего хлеба смешивается с ароматом пряностей. Люди суетятся, обсуждают цены, и всюду слышится звон монет."

    if first_visit_market:
        $ first_visit_market = False
        "Ваш взгляд привлекает прилавок с фруктами и бочонками мёда. За ним стоит девушка с лисьими ушами и пушистым хвостом."
        show h smile with dissolve

        h "Ох-хо, кто это к нам пожаловал? Новенький, да ещё и без товарного запаса. Совсем голодранец, что ли?"
        "Её янтарные глаза хитро поблёскивают, и на губах играет самодовольная ухмылка."
        p "Эм... Я просто осматриваюсь."
        h "Осматривайся, осматривайся. Главное, чтобы не пришлось осматривать пустой кошель... Хотя, глядя на тебя, он и так пустой, верно?"
        p "..."
        h "Хех, не обижайся. Я [h.name], мудрая волчица. Но, как видишь, теперь ещё и успешная торговка."
        
        p "[h.name]? Красивое имя... Я [hero_name]."
        h "[hero_name]? Хм... не звучит богато, но я запомню. Вдруг однажды ты разбогатеешь, и я смогу на тебе нажиться, ах-хаха!"

        h "Раз уж ты здесь, позволь задать тебе пару вопросов. Мне ведь нужно знать, с кем имею дело."
        h "Начнём с простого: какую еду ты предпочитаешь?"
        $holo_choices = 0
        menu:
            "Выбери вкус еды"
            "Солёное":
                h "Хм... Значит, у тебя характер крепкий, как выдержанный сыр. Это похвально!"
            "Острое":
                h "О-о, так ты любишь острые ощущения? Осторожней, иначе сожжёшь себе язык, а потом слова благодарности сказать не сможешь!"
            "Сладкое":
                $ holo_choices += 1
                h "О-хо-хо! Значит, ты любишь мёд и спелые яблоки? Хороший вкус, но не обольщайся — я делиться не стану!"
        h "Теперь серьёзный вопрос. Какое качество в людях ты ценишь больше всего?"
        menu:
            "Выбери качество"
            "Честность":
                $ holo_choices += 1
                h "Честность? Ох-хо, ты что, в сказку попал? Честные торговцы встречаются только в легендах."
            "Храбрость":
                h "Храбрый, значит? Хорошо, но помни: даже самый смелый волк не полезет в клетку к разъярённому медведю."
            "Доброта":
                h "Доброта – вещь полезная, но в торговле за неё не дают скидку. Хотя... если мне вдруг станет скучно, я дам тебе яблоко. Может быть."

        h "Последний вопрос... и, пожалуй, самый важный."  
        h "Какие женщины тебе нравятся?"  
        menu:
            "Выбери тип"
            "Нежные и заботливые":
                h "Хм... Значит, тебе нужны те, кто принесёт тебе кружку тёплого молока перед сном? Скучно-о!"
            "Умные, хитрые и с характером":
                $ holo_choices += 1
                h "О-хо-хо! Да ты разбираешься в хороших вещах, мальчишка. Может, не так уж ты и безнадёжен?"
            "Красивые":
                h "Красота – вещь хорошая, но если за ней пустота, то и разговаривать не о чем."
        h "Вот и славно! Теперь я знаю, что передо мной не просто болван, а кое-что интересное."  
        if (holo_choices == 3):
            $addLove("holo",10)
            "[h.name] смеётся, её хвост неторопливо покачивается из стороны в сторону. Кажется, ей понравился ваш ответ."
        h "Может, ещё заглянешь? Кто знает, вдруг я предложу тебе выгодную сделку... или устрою тебе ещё один экзамен."
        hide h
        jump market_menu
    else:
        "Вы снова на рынке. [h.name] замечает вас и лениво махает хвостом, но сегодня не пристаёт с вопросами – видимо, её развлекло что-то другое."
        jump market_menu


label market_menu:
    menu:
        "Подойти к [h.name]":
            jump visit_holo
        "Притвориться мертвым" if not can_visit_hospital:
            "Ты упал и притворился мертвым"
            "Вышло настолько хорошо, что тебя схватили и куда-то понесли"
            "Ты пытался вырываться и кричать, но люди думали, что ты кричишь от боли"
            "У тебя получилось убедить всех, что ты в порядке, но тебя уже принесли в больницу"
            "Тебя уже захотели избить за такое, но тебе удалось забежать в больницу"
            jump hospital
        "Уйти":
            jump city

label visit_holo:
    show h
    "TODO стандартное приветствие"
    jump holo_menu

label holo_menu:
    menu:
        "Купить товары":
            h "О-хо-хо, [hero_name], неужели ты наконец разжился монетками?"
            jump holo_market_menu
        # "Чем тебе помочь?" if can_work_with_holo:
        # "Попросить задание":
        # "Отказаться от задания":
        "Спросить, как тут заработать" if not can_work_with_holo or not can_visit_tavern:
            p "Слушай, [h.name], а как в этом городе можно заработать денег?"
            h "О-хо-хо! [hero_name]! Я не ошиблась! Ты действительно бедный!"
            "[h.name] очень рада и кричит об этом на весь рынок, ты чувствуешь себя униженным"
            h "Ладно, подскажу по дружески, можешь, например, пойти подработать в таверну, там всегда руки нужны."
            $ can_visit_tavern = True
            h "Ну или можешь мне помогать, я тоже в долгу не останусь~"
            $ can_work_with_holo = True
            jump holo_menu
        "Уйти":
            jump market

label holo_market_menu:
    #каждую книгу можно прочитать дома(надо прочитать 3 раза, чтобы закончить ее)
    menu:
        # "Купить мотивирующую книгу(20 монет)":
        # "Купить зеркало(50 монет)":
        # "Купить артефакт \"PlusSize\"(100 монет)":
        # "Купить гантели легкие(20 монет)":
        # "Купить гантели средние(50 монет)":
        # "Купить гантели тяжелые(100 монет)":
        # "Купить книгу(20 монет)":
        # "Купить магический шар(50 монет)":
        # "Купить гримуар(100 монет)":
        # "Купить путеводитель по лесу(100 монет)":
        # "Купить краткий экскурс по ведению боя(100 монет)":#отступление теперь доступно при малом количестве хп
        "Уйти":
            h "Приятно было с тобой сотрудничать"
            jump market_menu