define first_time_guild = True
define battle_location_guild = "guild"
label guild:
    scene bg guild with fade

    if first_time_guild:
        $ first_time_guild = False
        "Ты впервые заходишь в гильдию бойцов, и первое, что бросается в глаза — хаотичное движение повсюду. Бойцы всех возрастов тренируются, спорят, смеются и меряются силой."
        "В углу несколько человек отрабатывают удары по груше, в центре — пара спаррингующихся, а дальше, у дальнего края зала, стоит высокая блондинка в тяжёлых доспехах, наблюдая за всем этим с грозным видом."

        show nag normal at left
        nag "Хехе, круто, да? Добро пожаловать в гильдию бойцов, [hero_name]!"

        p "Здесь шумно... и немного пахнет потом."

        nag "Ну ещё бы! Тут каждый день кто-то получает по морде. Или сам кому-то раздаёт! Боль и пот — залог успеха, ха-ха!"

        p "Не знаю, насколько мне нравится эта философия..."

        nag "Тебе ещё понравится! А пока я должна тебя кое с кем познакомить."

        "Нагаторо хватает тебя за руку и уверенно ведёт к женщине в доспехах."

        show d smirk at right
        "Блондинка с гордо поднятой головой и боевым взглядом производит внушительное впечатление. Она выглядит сильной, серьёзной и... слегка странной? Её щёки будто бы горят от какого-то внутреннего возбуждения."

        nag "[d.name]! У нас новенький!"

        d "О-о-о, значит, ещё одна молодая душа ищет путь истинного воина? Великолепно! Я, Лала... кхм, [d.name], приму тебя в гильдию! Но сперва..."

        p "Ага, что-то мне подсказывает, что будет 'но сперва'..."

        d "Ты должен пройти испытание! Ведь настоящий боец должен уметь выдерживать и наносить удары... или хотя бы справляться с нестандартными ситуациями!"

        nag "Ты не хочешь, чтобы он снова бил тебя, да?.."

        d "Н-нет! В этот раз у меня другая проверка!"  
        "[d.name] принимает боевую стойку, но её поза больше похожа на ожидающую жертву, чем на защиту."

        d "Твоя задача — продемонстрировать силу и решительность! Действуй, [hero_name]!"

        menu:
            "Ударить её":
                "Ты решительно сжимаешь кулак и наносишь сильный удар."
                "[d.name] слегка отшатывается, но вместо боли в её глазах появляется что-то похожее на восторг..."
                d "О-о-о... как грубо! Ты даже не колебался! Какой... какой дикарь!"
                nag "Фу-у, [hero_name]! Серьёзно? Это было слишком!"
                $minusLove("nag",10)
                jump guild_menu

            "Схватить сзади, чтобы контролировать её движения":
                if strength > 50:
                    "Ты молниеносно двигаешься вперёд, хватаешь [d.name] за руки и фиксируешь её в железном захвате. Она пытается вырваться, но безуспешно."
                    d "Ах! Ты так силён! И не даёшь мне двигаться... Невероятно!"
                    nag "Хо-хо, [hero_name], ты даже меня удивил!"
                    $addLove("nag",10)
                    $addLove("d",10)
                else:
                    "Ты пытаешься схватить её, но [d.name] неожиданно резко дёргается и вырывается."
                    d "Хм? О, ты хотел меня обездвижить? Неплохо, но недостаточно силы!"
                    nag "Ха-ха, ну, по крайней мере, ты старался!"
                jump guild_menu

            "Схватить за грудь":
                "Ты делаешь неожиданный шаг вперёд и накрываешь ладонями её внушительную грудь."
                "Вокруг замирает тишина. [d.name] сначала замирает, затем закрывает глаза и начинает медленно краснеть..."
                d "Н-ничего себе... Такая наглость... Ты даже не задумывался, просто сделал это..."
                nag "[hero_name]! Ты извращенец! Ты даже не попытался сделать что-то нормальное!"
                "Но [d.name] явно не в обиде. Скорее наоборот..."
                $addLove("d",10)
                jump guild_menu

            "Отказаться":
                p "Нет уж, это испытание какое-то странное."
                d "Ч-что? Ты... отказываешься? Отказываешься испытать себя и меня?!"
                nag "Ну, тут я даже согласна с [hero_name]. Это действительно было странно..."
                d "Ах... какой стыд... такой шанс упущен..."
                $minusLove("d",10)
                jump guild_after_trial
    else:
        "Ты в гильдии."

    jump guild_menu

label guild_menu:
    hide d
    hide nag
    menu:
        "Тренироваться в спарринге":
            call start_battle(100, strength, "Противник", battle_location_guild)
            if last_battle_win:
                "Я определенно становлюсь все лучше!"
                $addChar(["str"], 3)
                jump guild_menu
            else:
                "Надо больше заниматься"
                jump guild_menu
        "Качаться":
            call start_muscule
            if last_muscule_win:
                "Я определенно становлюсь все лучше!"
                $addChar(["str"], 2)
                jump guild_menu
            else:
                "Надо больше заниматься"
                jump guild_menu
        "Найти наставницу":
            jump guild_d_menu
        "Отправиться в город":
            jump city

label guild_look_around:
    "Ты осматриваешься..."
    "IN PROGRESS"
    jump guild_menu
    # menu:
    #     "Навестить [.name]" if not first_time_rapunzel:
    #         jump visit_rapunzel_forest
    #     "Навестить [e.name]" if not first_time_elsa:
    #         jump visit_elsa_forest
    #     "Навестить [nag.name]" if not first_time_nagatoro:
    #         jump visit_nagatoro_forest
    #     "Вернуться назад":
    #         jump forest
