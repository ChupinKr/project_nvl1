define correct_answers = 0  # Счётчик правильных ответов
define first_time_tavern = True


# Сцена с таверной
label tavern:
    scene tavern_bg with fade
    "Вы в таверне"
    menu:
        "Пойти в комнату" if can_visit_home:
                jump room
        "Подойти к [miku.name]" :
            jump go_to_miku_stand
        "Подойти к сомнительному столу" if not can_visit_black_market:
            jump suspicious_table
        "Подойти к доске объявлений":
            jump tavern_task_board
        "Выйти в город":
                jump city

label go_to_miku_stand:
    scene tavern_bg with fade
    if first_time_tavern:
        $ first_time_tavern = False
        $ miku.name = "Мику"
        miku "Привет-привет! Добро пожаловать в таверну \"Звездные осколки\"!" 
        miku "Я Мику, хозяйка этого местечка! Если что-то нужно – просто спрашивай, не стесняйся!" 
    else:
        miku "Ой, опять ты! Как здорово! Чего желаешь сегодня?"
    jump miku_stand_menu

label miku_stand_menu:
    menu:
        "Поговорить":
            if not can_visit_home:
                miku "Чем могу помочь?" 
            jump talk_miku_menu
        "Подойти к сомнительному столу" if not can_visit_black_market:
            miku "Они всегда здесь, что-то мутят... но если решите подойти, будьте осторожны."
            jump suspicious_table
        "Уйти":
            miku "Была рада вас видеть!"
            jump tavern

label talk_miku_drinks_menu:
    miku "У нас тут не только пиво, но и магические напитки! Что будешь?"
    menu:
        "Энергетический эль (5 золота, +2 к выносливости)":
            if money >= 5:
                $ money -= 5
                $ stamina += 2
                miku "Ооо, хорошенький выбор! Попробуй – освежает!"
            else:
                miku "Эх, золотишка не хватает... Может, сначала квестик возьмёшь?"
        "Магический ликёр (10 золота, +2 к мане)":
            if money >= 10:
                $ money -= 10
                $ mana += 2
                miku "Этот напиток буквально искрит энергией! Ну-ка, выпей!"
            else:
                miku "Эй, кажется, у тебя не хватает монеток!"
        "Чёрный ром (15 золота, +1 к силе, +1 к выносливости)":
            if money >= 15:
                $ money -= 15
                $ strength += 1
                $ stamina += 1
                miku "Ого, крепкий выбор! Только не переборщи!"
            else:
                miku "Хм... похоже, придётся немного подкопить!"
        "Не хочу пить":
            miku "Окей, если передумаешь – я тут!"
    jump talk_miku_menu


label talk_miku_menu:
    menu:
        "Снять комнату" if not can_visit_home:
            miku "Комната стоит 10 золотых в неделю."
            menu:
                "Беру" if money >= 10:
                    $ money -= 10  # Вычитание золота
                    $ can_visit_home = True
                    jump room
                "Мне пока не по карману":
                    jump talk_miku_menu
        "Попросить что-нибудь выпить":
            miku "Что будете пить?"
            miku "Здесь можно найти не только пиво, но и кое-что поинтереснее."
            jump talk_miku_drinks_menu
        "Спросить, какие есть задания":
            jump talk_miku_quests
        "Спросить, чем заняться в городе":
            jump talk_miku_info
        "Ничего":
            jump miku_stand_menu

label talk_miku_quests:
    miku "Квесты? Отличная идея! Вот что у меня есть!"
    menu:
        "Помочь на кухне (5 золота)":
            miku "Надо нарезать овощи и проверить запасы! Готов?"
            "Ты провёл время, помогая Мику. Всё прошло удачно!"
            $ addMoney(5)
        "Прогнать шумных клиентов (10 золота)":
            miku "Эти парни никак не угомонятся! Выгони их, и будет тебе награда!"
            "Ты поговорил с клиентами, и они ушли, хоть и неохотно."
            $ money += 10
            show text "+10 золота" at left with moveinleft
            pause 1.5
            hide text
        "Никакой работы":
            miku "Эх, ну ладно... Может, в другой раз!"
    jump talk_miku_menu

label talk_miku_info:
    if miku_love > 10 and not can_visit_library:
        miku "Ты мне нравишься! Ладно, расскажу тебе одну тайну... В городе есть **тайная библиотека**, где можно найти запрещённые магические знания!"
        $ can_visit_library = True
    elif miku_love > 20 and not can_visit_training_ground:
        miku "Знаешь, ты неплохой! Дам тебе наводку: неподалёку есть **тайное место для тренировок**. Если хочешь стать сильнее – тебе туда!"
        $ can_visit_training_ground = True
    elif miku_love > 30 and not can_visit_bar:
        miku "Ты определённо мне по душе! В городе есть **закрытый бар**, куда пускают только своих. Там можно найти очень... полезных знакомств!"
        $ can_visit_bar = True
    elif miku_love > 50:
        miku "Знаешь... мне нравится, что ты не просто клиент. Я могу показать тебе нечто особенное... но только если ты готов к этому~"
    else:
        miku "Хмм, пока ты ещё не заслужил моего доверия! Может, поможешь мне с парочкой дел?"
    jump talk_miku_menu

label tavern_task_board:
    miku "Эй! Если тебе нужны деньги или опыт, взгляни на **доску объявлений**! Всегда найдётся интересное задание!"
    menu:
        "Помочь стражникам (10 золота)":
            "Ты провёл день, помогая стражникам следить за порядком."
            $ money += 10
        "Собрать лечебные травы (5 золота, +1 к выживанию)":
            "Ты нашёл полезные травы, которые пригодятся целителям."
            $ money += 5
            $ survival += 1
        "Охота на гоблинов (15 золота, +1 к силе)":
            "Ты сразился с гоблинами и одержал победу!"
            $ money += 15
            $ strength += 1
        "Уйти":
            miku "Ну ладно, если передумаешь – заглядывай!"
    jump tavern



# Сцена с комнатой игрока
label room:
    scene room_bg with fade
    "Ты у себя в комнате"
    
    menu:
        "Отдохнуть и провести ночь":
            "Как же давно я не мог отдохнуть"
            $ health = health + 5
        "Покинуть комнату":
            "Вы идете в таверну"
            jump tavern
        "Пойти в город":
            "Вы вышли в город"
            jump city

# Сцена с сомнительным столом
label suspicious_table:
    scene tavern_bg
    guy1 "Ну что, парниша, выглядишь, как тот, кто может сделать нужные вещи. Хочешь поговорить о том, как войти в темные дела?"
    guy2 "Тебе нужно знать кое-что, если ты хочешь быть частью нашего круга. Но для этого нужно доказать, что ты не ссышь."

    guy3 "Ты оказался в ситуации, когда враг держит твоих людей. Что будешь делать?"
    menu:
        "Взять его семью в заложники и пригрозить, что расправлюсь с ними.":
            $ correct_answers += 1  # Правильный ответ
            guy3 "Вот это я понимаю! Важно, чтобы враг знал, что у него нет выбора. Любая слабость — это шанс на поражение."
        "Попробую заплатить за их свободу, может, повезет.":
            guy2 "Слабый ход, ты не понимаешь, что с таким подходом тебя могут выдать."
        "Просто устроить засаду и уничтожить его людей, а его оставить в живых для допроса.":
            guy1 "Слишком долго думаешь, чувак, ты должен быть быстрее и жестче."

    guy1 "Тебя поймали на незаконной сделке, и стража хочет забрать твою голову. Как выберешься?"
    menu:
        "Подкупить стражу, отстегну баблишка в сделке и они тоже будут замешаны.":
            $ correct_answers += 1  # Правильный ответ
            guy2 "Сыграно по-крупному. Крути им яйца, пока не отсохнут."
        "Сдаться и заплатить за свои грехи.":
            guy3 "Сдавайся, и ты обречен. Такие как ты, сдаются первым, а потом их используют."
        "Устроить взрыв на складе с товаром, чтобы отвлечь их внимание, и сбежать.":
            guy1 "Вот это по делу! Но у меня вопрос: как ты потом будешь уходить из города, чтобы не попасться?"

    guy2 "Как выкрутиться, если ты попал в плен к врагу, но у тебя есть информация о его слабостях?"
    menu:
        "Воспользоваться слабостями, загнать их в ловушку, предложить сделку, от которой не смогут отказаться и подставить.":
            $ correct_answers += 1  # Правильный ответ
            guy3 "Вот это поворот! Играй с их умом, дави каждого, кто может помешать."
        "Предложить сделку, но не раскрывать все карты.":
            guy2 "Тебя сожрут. Ты думаешь, они поверят в твои обманки?"
        "Сделать вид, что ты сошел с ума и не помнишь, что ты им должен.":
            guy1 "Ты что, с ума сошел? Если ты не будешь жестким, тебя съедят."

    guy3 "Ты оказался в засаде. Ты и твоя группа. Ты единственный, кто не был пойман. Если ты убьешь одного из своих, враги уйдут, а ты сможешь спастись. Что будешь делать?"
    menu:    
        "Убью того, кто слаб и ничего не принесет для нашей группы. Я живу — значит, всё, что важно.":
            $ correct_answers += 1  # Правильный ответ
            guy2 "Вот это решение! Правильный подход. Ты ставишь себя выше всех остальных, даже если придется идти по трупам."
        "Попробую уговорить остальных сдаться, чтобы выжить, может, враги пощадят нас.":
            guy3 "Тебя сожрут. Никто не щадит слабых, ты либо идешь по головам, либо умираешь."
        "Попробую спрятаться и надеяться, что меня не заметят. Возможно, кто-то сможет выбраться.":
            guy1 "Ты слаб. Сильные идут вперед, и не боятся идти по трупам ради своего спасения."

    guy2 "Твои товарищи схвачены, но ты успел скрыться. Враги заставляют тебя выбрать: один из твоих товарищей будет казнен, а все остальные получат свободу. Как поступишь?"
    menu:
        "Выберу того, кто может быть слабым звеном и принесет больше проблем. Отпущу остальных.":
            $ correct_answers += 1  # Правильный ответ
            guy1 "Вот это реально решение. Ты не теряешь время на чувства, ты спасешь себя и своих."
        "Попробую договориться, но знаю, что это приведет к последствиям для меня.":
            guy2 "Не будь идиотом. Договориться с ними — это как просить их убить тебя помедленнее."
        "Сдамся и скажу, что готов принять смерть, чтобы другие выжили.":
            guy3 "Слабак. Такая слабость — это твоя смерть. Мы не находимся в этом мире, чтобы мучиться."

    # Проверка правильности ответов
    if correct_answers >= 5:
        $ can_visit_black_market = True
        guy3 "Ты понимаешь, что такое жесткость и сила. Заходи в старый амбар на окраине города, и забудь обо всех остальном. За тебя словечко замолвим."
    else:
        guy1 "Тебе не место среди нас, если ты не готов убить ради выгоды. Слишком мягок, брат."

    jump tavern